<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Retail Management</title>
  <link rel="icon" type="image/png" href="https://i.imgur.com/h08m3tz.png" />
  <script src="https://cdn.tailwindcss.com"></script>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap"
    rel="stylesheet"
  />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"></link>
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background: #f5f7fa;
      min-height: 100vh;
      margin: 0;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      color: #374151;
      font-size: 14px;
      line-height: 1.5;
    }
    #app {
      max-width: 900px;
      margin: 2rem auto 3rem;
      padding: 0 1rem;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    header {
      background: #ffffff;
      border-radius: 0.75rem;
      padding: 1rem 1.25rem;
      display: flex;
      align-items: center;
      gap: 1rem;
      user-select: none;
      box-shadow: 0 2px 8px rgb(0 0 0 / 0.05);
      flex-wrap: wrap;
      position: relative;
      z-index: 10;
    }
    #headerIconWrapper {
      width: 44px;
      height: 44px;
      border-radius: 0.5rem;
      border: 2.5px solid #f97316;
      background: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      box-shadow: 0 1px 5px rgb(249 115 22 / 0.3);
      flex-shrink: 0;
      transition: box-shadow 0.3s ease;
    }
    #headerIconWrapper:hover {
      box-shadow: 0 4px 12px rgb(249 115 22 / 0.5);
    }
    #headerIcon {
      width: 36px;
      height: 36px;
      border-radius: 0.4rem;
      object-fit: cover;
      background: transparent;
      position: relative;
      z-index: 1;
    }
    #retailTitle {
      background: linear-gradient(90deg, #06b6d4, #3b82f6, #9333ea);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-fill-color: transparent;
      font-weight: 700;
      font-size: 1.3rem;
      line-height: 1.2;
      user-select: text;
      white-space: nowrap;
      flex-grow: 1;
      min-width: 0;
    }
    #semesterContainer {
      display: flex;
      align-items: center;
      gap: 0.4rem;
      font-weight: 500;
      color: #6b7280;
      font-size: 0.85rem;
      user-select: text;
      white-space: nowrap;
      margin-top: 0.15rem;
    }
    #audioControlBtn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 28px;
      height: 28px;
      cursor: pointer;
      color: #f97316;
      background-color: transparent;
      border: none;
      border-radius: 50%;
      padding: 0;
      margin-left: 0.4rem;
      flex-shrink: 0;
      position: relative;
      transition: color 0.3s ease;
      font-size: 1.1rem;
      line-height: 1;
      box-shadow: 0 2px 6px rgb(249 115 22 / 0.3);
      user-select: none;
    }
    #audioControlBtn:hover {
      color: #c2410c;
      box-shadow: 0 4px 12px rgb(194 65 12 / 0.6);
    }
    #currentDateContainer {
      margin-top: 1.5rem;
      background: #d1fae5;
      color: #065f46;
      padding: 0.5rem 1.25rem;
      border-radius: 9999px;
      font-weight: 600;
      font-size: 0.9rem;
      box-shadow: 0 2px 8px rgb(5 95 70 / 0.15);
      user-select: none;
      max-width: 900px;
      margin-left: auto;
      margin-right: auto;
      display: flex;
      align-items: center;
      gap: 0.6rem;
      white-space: nowrap;
      position: relative;
      z-index: 5;
      flex-wrap: nowrap;
      justify-content: center;
    }
    #currentDateContainer i {
      font-size: 1.4rem;
      flex-shrink: 0;
    }
    #currentDateContainer .divider {
      width: 2px;
      height: 1.4rem;
      background-color: #10b981;
      border-radius: 1px;
      opacity: 0.8;
    }
    #nextExamNotification > div {
      display: flex;
      align-items: center;
      gap: 0.6rem;
      font-weight: 700;
      font-size: 1.1rem;
      border-radius: 1rem;
      padding: 0.6rem 1.25rem;
      cursor: pointer;
      user-select: none;
      overflow: hidden;
      transition: background-color 0.3s ease, color 0.3s ease, box-shadow 0.25s ease;
      border: 1.5px solid transparent;
      box-shadow: 0 3px 12px rgb(0 0 0 / 0.07);
      background-color: #f9fafb;
      color: #374151;
      max-width: 100%;
      margin: 2rem auto 2.5rem auto;
      flex-wrap: nowrap;
    }
    #nextExamNotification > div:hover {
      box-shadow: 0 8px 28px rgb(0 0 0 / 0.15);
      background-color: #e0e7ff;
      color: #1e40af;
      border-color: #6366f1;
    }
    #nextExamNotification > div.default {
      background-color: #f9fafb;
      color: #4b5563;
      border-color: #d1d5db;
      box-shadow: 0 2px 8px rgb(0 0 0 / 0.05);
      cursor: default;
    }
    #nextExamNotification > div.hour1 {
      color: #1e3a8a;
      background-color: #c7d2fe;
      border-color: #818cf8;
      box-shadow: 0 4px 14px rgb(129 140 248 / 0.4);
    }
    #nextExamNotification > div.hour2 {
      color: #4338ca;
      background-color: #a5b4fc;
      border-color: #6366f1;
      box-shadow: 0 4px 14px rgb(99 102 241 / 0.5);
    }
    #nextExamNotification > div.hour3 {
      color: #7c2d12;
      background-color: #fed7aa;
      border-color: #fb923c;
      box-shadow: 0 4px 14px rgb(251 146 60 / 0.5);
    }
    #nextExamNotification > div.hour4plus {
      color: #065f46;
      background-color: #bbf7d0;
      border-color: #34d399;
      box-shadow: 0 4px 14px rgb(52 211 153 / 0.5);
    }
    #nextExamNotification > div.alert {
      color: #b45309;
      background-color: #fef3c7;
      border-color: #fbbf24;
      animation: pulse 2s infinite ease-in-out;
      font-weight: 800;
      box-shadow: 0 0 12px 3px rgb(251 191 36 / 0.7);
    }
    #nextExamNotification i {
      flex-shrink: 0;
      font-size: 1.5rem;
      min-width: 1.5rem;
      text-align: center;
      color: inherit;
    }
    #nextExamNotification strong {
      flex-shrink: 0;
      font-weight: 700;
      font-size: 1.15rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 60%;
      line-height: 1.3;
      color: inherit;
      user-select: text;
    }
    #nextExamNotification span.date {
      flex-shrink: 0;
      white-space: nowrap;
      min-width: 6.5rem;
      font-weight: 600;
      font-size: 0.9rem;
      text-align: right;
      color: inherit;
    }
    #nextExamNotification span.timeleft {
      flex-shrink: 0;
      white-space: nowrap;
      font-weight: 700;
      min-width: 8.5rem;
      text-align: right;
      font-variant-numeric: tabular-nums;
      color: inherit;
    }
    @media (max-width: 720px) {
      #nextExamNotification > div {
        flex-wrap: wrap;
        font-size: 0.95rem;
        gap: 0.4rem;
      }
      #nextExamNotification strong {
        max-width: 100%;
        white-space: normal;
      }
      #nextExamNotification span.date,
      #nextExamNotification span.timeleft {
        min-width: auto;
        text-align: left;
        flex: 1 1 100%;
      }
    }
    /* Date filters container */
    #dateFilters {
      justify-content: center;
      margin-bottom: 1.25rem;
      gap: 0.4rem;
      flex-wrap: wrap;
      display: flex;
      width: 100%;
    }
    /* Date chips */
    .date-chip {
      padding: 0.3rem 0.8rem;
      border-radius: 9999px;
      font-size: 0.8rem;
      font-weight: 600;
      border: 2px solid #f97316;
      background-color: white;
      color: #f97316;
      box-shadow: 0 2px 6px rgb(249 115 22 / 0.25);
      transition: all 0.3s ease;
      cursor: pointer;
      user-select: none;
      min-width: 95px;
      text-align: center;
      white-space: nowrap;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.3rem;
      flex-shrink: 0;
    }
    .date-chip i {
      font-size: 0.9rem;
      color: #f97316;
      flex-shrink: 0;
    }
    .date-chip:hover:not(:disabled) {
      background-color: #f97316;
      color: white;
      box-shadow: 0 5px 16px rgb(249 115 22 / 0.6);
      transform: scale(1.05);
    }
    .date-chip[aria-pressed="true"] {
      background-color: #f97316;
      color: white;
      box-shadow: 0 5px 16px rgb(249 115 22 / 0.6);
      cursor: default;
      transform: scale(1.05);
    }
    .date-chip:disabled {
      cursor: not-allowed;
      opacity: 0.4;
      background-color: #f3f4f6 !important;
      color: #9ca3af !important;
      border-color: #d1d5db !important;
      box-shadow: none;
      transform: none;
    }
    /* Masked style for completed dates */
    .date-chip.masked {
      cursor: default;
      background-color: #f3f4f6 !important;
      color: #9ca3af !important;
      border-color: #d1d5db !important;
      box-shadow: none !important;
      opacity: 0.5;
      pointer-events: none;
      user-select: none;
    }
    /* Exam cards grid */
    #examList {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 0.9rem;
      width: 100%;
    }
    /* Exam card */
    .exam-card {
      background: white;
      border-radius: 0.6rem;
      box-shadow: 0 4px 12px rgb(0 0 0 / 0.06);
      overflow: hidden;
      cursor: pointer;
      transition: transform 0.25s ease, box-shadow 0.25s ease;
      display: flex;
      flex-direction: row;
      border: 3px solid transparent;
      animation: slideIn 0.35s ease forwards;
      user-select: none;
      min-height: 75px;
      align-items: center;
      padding: 0.55rem 1rem;
      gap: 0.85rem;
    }
    .exam-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 22px rgb(0 0 0 / 0.15);
      border-color: #f97316;
    }
    .exam-card.collapsing {
      animation: fallAndFade 0.8s forwards;
      pointer-events: none;
    }
    .exam-card.opacity-50 {
      opacity: 0.5;
      cursor: default;
      pointer-events: none;
      box-shadow: none;
      border-color: #d1d5db;
      transform: none !important;
    }
    .exam-card .icon-wrapper {
      flex-shrink: 0;
      width: 38px;
      height: 38px;
      border-radius: 50%;
      background-color: white;
      box-shadow: 0 1px 6px rgb(0 0 0 / 0.1);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #374151;
      font-size: 1.25rem;
      transition: color 0.3s ease;
      user-select: none;
    }
    .exam-card:hover .icon-wrapper {
      color: #f97316;
      box-shadow: 0 4px 15px rgb(249 115 22 / 0.5);
    }
    .exam-card .info {
      flex-grow: 1;
      min-width: 0;
      display: flex;
      flex-direction: column;
      justify-content: center;
      gap: 0.12rem;
      overflow: hidden;
    }
    .exam-card h3 {
      font-size: 1rem;
      font-weight: 700;
      color: #111827;
      margin: 0;
      line-height: 1.2;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      user-select: text;
    }
    .exam-card .sub-info {
      display: flex;
      gap: 0.9rem;
      font-size: 0.8rem;
      color: #6b7280;
      font-weight: 600;
      user-select: none;
      flex-wrap: wrap;
    }
    .exam-card .sub-info span {
      white-space: nowrap;
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }
    .exam-card .sub-info span i {
      font-size: 0.8rem;
      color: #9ca3af;
      flex-shrink: 0;
    }
    .exam-card .chevron {
      flex-shrink: 0;
      color: #9ca3af;
      font-size: 1.1rem;
      transition: color 0.3s ease;
      user-select: none;
    }
    .exam-card:hover .chevron {
      color: #f97316;
    }
    /* No results */
    #noResults {
      max-width: 600px;
      margin: 3rem auto;
      color: #9ca3af;
      font-size: 1rem;
      user-select: none;
      text-align: center;
    }
    #noResults i {
      font-size: 3rem;
      margin-bottom: 1rem;
      color: #d1d5db;
    }
    /* Animations */
    @keyframes slideIn {
      from {
        transform: translateY(15px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }
    @keyframes fallAndFade {
      0% {
        opacity: 1;
        transform: translateY(0);
        height: auto;
        margin-bottom: 1.25rem;
        padding: 0;
      }
      100% {
        opacity: 0;
        transform: translateY(40px);
        height: 0;
        margin-bottom: 0;
        padding: 0;
      }
    }
  </style>
</head>
<body>
  <div id="app" role="main" aria-label="Retail Management Application">
    <header>
      <div id="headerIconWrapper" aria-label="Retail Management logo with simple orange border" role="img">
        <img id="headerIcon" src="https://i.giphy.com/4cJAkBS9KAOz2px44s.webp" alt="Animated gif icon showing a colorful swirling pattern with bright neon colors in motion" />
      </div>
      <div style="flex-grow:1; min-width:0;">
        <h1 id="retailTitle" class="select-text">Retail Management</h1>
        <div id="semesterContainer">
          <p class="m-0">4th SEMESTER (जय श्री राम)</p>
        </div>
      </div>
      <button id="audioControlBtn" aria-label="Mute audio" title="Mute audio" type="button" tabindex="0" aria-pressed="false">
        <i class="fas fa-volume-up" aria-hidden="true"></i>
      </button>
    </header>

    <div id="currentDateContainer" aria-live="polite" aria-atomic="true" title="Current date and time">
      <i class="fas fa-calendar-day" aria-hidden="true"></i>
      <span class="date-part">Loading...</span>
      <span class="divider" aria-hidden="true"></span>
      <span class="time-part"></span>
    </div>

    <section id="nextExamNotification" aria-live="polite" aria-atomic="true">
      <div role="link" tabindex="0" aria-label="Next exam notification" class="default">
        <i class="fas fa-bell" aria-hidden="true"></i>
        <strong class="truncate">Loading next exam...</strong>
        <span class="date"></span>
        <span class="timeleft"></span>
      </div>
    </section>

    <main>
      <div id="dateFilters" class="flex"></div>
      <div id="examList" aria-live="polite" aria-atomic="true"></div>
      <div id="noResults" class="hidden" role="alert" aria-live="assertive">
        <i class="fas fa-search" aria-hidden="true"></i>
        <p>No exams found matching your search.</p>
      </div>
    </main>
  </div>

  <script>
    (() => {
      const examSchedule = [
        {
          date: "22-04-2025",
          day: "Tuesday",
          paper: "Supply Chain Management (SCM)",
          code: "ARM-S-447-B",
          path: "https://telegra.ph/androidneeds-03-02",
          color: "bg-blue-100 border-blue-300",
          icon: "truck-loading",
        },
        {
          date: "23-04-2025",
          day: "Wednesday",
          paper: "Visual Merchandising (VM)",
          code: "ARM-S-448-B",
          path: "https://telegra.ph/How-to-Make-Your-Own-Hand-Sanitizer-04-25",
          color: "bg-pink-100 border-pink-300",
          icon: "palette",
        },
        {
          date: "24-04-2025",
          day: "Thursday",
          paper: "E-Retailing (ER)",
          code: "ARM-S-449-B",
          path: "https://telegra.ph/Fraudsters-Try-To-Scam-PM-CARES-Donors-With-Fake-UPI-ID-03-31",
          color: "bg-purple-100 border-purple-300",
          icon: "shopping-cart",
        },
        {
          date: "25-04-2025",
          day: "Friday",
          paper: "Marketing Research (MR)",
          code: "ARM-S-450-B",
          path: "https://telegra.ph/Top-sites-for-career-04-11",
          color: "bg-green-100 border-green-300",
          icon: "chart-line",
        },
        {
          date: "28-04-2025",
          day: "Monday",
          paper: "International Retailing and Bench Mark Retailers (IR & BR)",
          code: "ARM-S-451-B",
          path: "https://telegra.ph/The-Deverakonda-Foundation-04-26",
          color: "bg-yellow-100 border-yellow-300",
          icon: "globe-americas",
        },
        {
          date: "29-04-2025",
          day: "Tuesday",
          paper: "Multi Brand Retailing (MBR)",
          code: "ARM-S-452-B",
          path: "https://telegra.ph/Projects-to-do-04-12",
          color: "bg-indigo-100 border-indigo-300",
          icon: "store",
        },
        {
          date: "30-04-2025",
          day: "Wednesday",
          paper: "Retail Communications (RC)",
          code: "ARM-S-453-B",
          path: "https://telegra.ph/Big-news-03-30",
          color: "bg-red-100 border-red-300",
          icon: "comments",
        },
      ];

      let selectedDate = null;

      const dateFilters = document.getElementById("dateFilters");
      const examList = document.getElementById("examList");
      const noResults = document.getElementById("noResults");
      const currentDateContainer = document.getElementById("currentDateContainer");
      const currentDatePart = currentDateContainer.querySelector(".date-part");
      const currentTimePart = currentDateContainer.querySelector(".time-part");
      const nextExamNotification = document.getElementById("nextExamNotification");
      const nextExamDiv = nextExamNotification.querySelector("div");
      const nextExamStrong = nextExamDiv.querySelector("strong");
      const nextExamDateSpan = nextExamDiv.querySelector("span.date");
      const nextExamTimeLeftSpan = nextExamDiv.querySelector("span.timeleft");

      // Audio setup
      const audio = new Audio("https://od.lk/s/NDJfNDc5OTY3MjNf/Truth%20on%20the%20Wall%20%28Audio%29%20_%20Mangalavaaram%20_%20Payal%20Rajput%20_%20Ajay%20Bhupathi%20_%20B%20Ajaneesh%20Loknath.m4a");
      audio.volume = 0.3;
      audio.preload = "auto";
      audio.autoplay = true;
      audio.loop = false;
      audio.muted = false;

      window.addEventListener("load", () => {
        audio.play().catch(() => {
          function userInteract() {
            audio.muted = false;
            audio.play().catch(() => {});
            window.removeEventListener("click", userInteract);
            window.removeEventListener("keydown", userInteract);
            window.removeEventListener("touchstart", userInteract);
          }
          window.addEventListener("click", userInteract);
          window.addEventListener("keydown", userInteract);
          window.addEventListener("touchstart", userInteract);
        });
      });

      const audioControlBtn = document.getElementById("audioControlBtn");

      function updateAudioButton() {
        if (audio.muted || audio.volume === 0) {
          audioControlBtn.setAttribute("aria-label", "Unmute audio");
          audioControlBtn.setAttribute("title", "Unmute audio");
          audioControlBtn.setAttribute("aria-pressed", "true");
          audioControlBtn.innerHTML = `<i class="fas fa-volume-mute" aria-hidden="true"></i>`;
        } else {
          audioControlBtn.setAttribute("aria-label", "Mute audio");
          audioControlBtn.setAttribute("title", "Mute audio");
          audioControlBtn.setAttribute("aria-pressed", "false");
          audioControlBtn.innerHTML = `<i class="fas fa-volume-up" aria-hidden="true"></i>`;
        }
      }

      audioControlBtn.addEventListener("click", () => {
        if (audio.muted || audio.volume === 0) {
          audio.muted = false;
          if (audio.paused) {
            audio.play().catch(() => {});
          }
        } else {
          audio.muted = true;
        }
        updateAudioButton();
      });

      audioControlBtn.addEventListener("keydown", (e) => {
        if (e.key === "Enter" || e.key === " ") {
          e.preventDefault();
          audioControlBtn.click();
        }
      });

      updateAudioButton();

      function getExamEndDateTime(exam) {
        const [dd, mm, yyyy] = exam.date.split("-");
        return new Date(`${yyyy}-${mm}-${dd}T17:00:00`);
      }

      function filterExams() {
        return examSchedule.filter(exam => {
          if (selectedDate && exam.date !== selectedDate) return false;
          const now = new Date();
          const examEnd = getExamEndDateTime(exam);
          return examEnd >= now;
        });
      }

      function renderDateFilters() {
        const uniqueDates = [...new Set(examSchedule.map((exam) => exam.date))];
        const now = new Date();

        dateFilters.innerHTML = "";
        uniqueDates.forEach((date) => {
          const examsOnDate = examSchedule.filter(e => e.date === date);
          const allPassed = examsOnDate.every(exam => getExamEndDateTime(exam) < now);

          const btn = document.createElement("button");
          btn.type = "button";
          btn.className = "date-chip";
          btn.setAttribute("aria-pressed", selectedDate === date);
          btn.title = `Filter exams on ${date}`;
          btn.innerHTML = `<i class="fas fa-calendar-alt" aria-hidden="true"></i>${date}`;
          if (allPassed) {
            btn.classList.add("masked");
            btn.disabled = true;
          } else {
            btn.addEventListener("click", () => {
              selectedDate = selectedDate === date ? null : date;
              render();
            });
          }
          dateFilters.appendChild(btn);
        });
      }

      function renderExams() {
        const filteredExams = filterExams();
        examList.innerHTML = "";

        if (filteredExams.length === 0) {
          noResults.classList.remove("hidden");
          return;
        } else {
          noResults.classList.add("hidden");
        }

        filteredExams.forEach((exam, index) => {
          const examEnd = getExamEndDateTime(exam);
          const now = new Date();
          const isPast = examEnd < now;

          if (isPast) return;

          const card = document.createElement("article");
          card.className = `exam-card ${exam.color}`;
          card.style.animationDelay = `${index * 0.1}s`;
          card.setAttribute("tabindex", "0");
          card.setAttribute("role", "link");
          card.setAttribute("aria-label", `Open details for exam ${exam.paper} on ${exam.date}`);

          card.addEventListener("click", () => {
            window.open(exam.path, "_blank", "noopener,noreferrer");
          });
          card.addEventListener("keydown", (e) => {
            if (e.key === "Enter" || e.key === " ") {
              e.preventDefault();
              card.click();
            }
          });

          const iconDiv = document.createElement("div");
          iconDiv.className = "icon-wrapper";
          const icon = document.createElement("i");
          icon.className = `fas fa-${exam.icon}`;
          icon.setAttribute("aria-hidden", "true");
          iconDiv.appendChild(icon);

          const infoDiv = document.createElement("div");
          infoDiv.className = "info";

          const title = document.createElement("h3");
          title.textContent = exam.paper;

          const subInfo = document.createElement("div");
          subInfo.className = "sub-info";

          const daySpan = document.createElement("span");
          daySpan.innerHTML = `<i class="fas fa-calendar-day" aria-hidden="true"></i> ${exam.day}`;

          const codeSpan = document.createElement("span");
          codeSpan.innerHTML = `<i class="fas fa-barcode" aria-hidden="true"></i> ${exam.code}`;

          subInfo.appendChild(daySpan);
          subInfo.appendChild(codeSpan);

          infoDiv.appendChild(title);
          infoDiv.appendChild(subInfo);

          const chevron = document.createElement("i");
          chevron.className = "fas fa-chevron-right chevron";
          chevron.setAttribute("aria-hidden", "true");

          card.appendChild(iconDiv);
          card.appendChild(infoDiv);
          card.appendChild(chevron);

          examList.appendChild(card);
        });
      }

      function updateCurrentDate() {
        const now = new Date();
        const optionsDate = { weekday: 'short', year: 'numeric', month: 'short', day: 'numeric' };
        const optionsTime = { hour: 'numeric', minute: '2-digit', second: '2-digit', hour12: true };
        const dateStr = now.toLocaleDateString(undefined, optionsDate);
        const timeStr = now.toLocaleTimeString(undefined, optionsTime);
        currentDatePart.textContent = dateStr;
        currentTimePart.textContent = timeStr;
      }

      function getNextExam() {
        const now = new Date();
        const upcomingExams = examSchedule
          .map(exam => {
            const [dd, mm, yyyy] = exam.date.split("-");
            const examStart = new Date(`${yyyy}-${mm}-${dd}T14:00:00`);
            const examEnd = new Date(`${yyyy}-${mm}-${dd}T17:00:00`);
            return { ...exam, examStart, examEnd };
          })
          .filter(exam => exam.examEnd >= now)
          .sort((a, b) => a.examStart - b.examStart);

        return upcomingExams.length > 0 ? upcomingExams[0] : null;
      }

      function formatTimeLeft(ms) {
        if (ms <= 0) return "0s";
        const totalSeconds = Math.floor(ms / 1000);
        const days = Math.floor(totalSeconds / 86400);
        const hours = Math.floor((totalSeconds % 86400) / 3600);
        const minutes = Math.floor((totalSeconds % 3600) / 60);
        const seconds = totalSeconds % 60;
        let result = "";
        if (days > 0) result += days + (days === 1 ? " day " : " days ");
        result +=
          (hours < 10 ? "0" : "") + hours + ":" +
          (minutes < 10 ? "0" : "") + minutes + ":" +
          (seconds < 10 ? "0" : "") + seconds;
        return result;
      }

      let nextExamInterval = null;

      function updateNextExamNotification() {
        const nextExam = getNextExam();
        if (!nextExam) {
          nextExamStrong.textContent = "No upcoming exams";
          nextExamDateSpan.textContent = "";
          nextExamTimeLeftSpan.textContent = "";
          nextExamDiv.className = "default";
          nextExamDiv.classList.remove("alert");
          nextExamDiv.classList.remove("hour1", "hour2", "hour3", "hour4plus");
          nextExamDiv.classList.remove("cursor-pointer");
          nextExamDiv.removeAttribute("role");
          nextExamDiv.removeAttribute("tabindex");
          nextExamDiv.onclick = null;
          nextExamDiv.onkeypress = null;
          if (nextExamInterval) {
            clearInterval(nextExamInterval);
            nextExamInterval = null;
          }
          return;
        }

        function updateTimeLeft() {
          const now = new Date();
          let timeLeftMs;
          let label;
          if (now < nextExam.examStart) {
            timeLeftMs = nextExam.examStart - now;
            label = "Starts in";
          } else if (now >= nextExam.examStart && now <= nextExam.examEnd) {
            timeLeftMs = nextExam.examEnd - now;
            label = "Ends in";
          } else {
            clearInterval(nextExamInterval);
            nextExamInterval = null;
            render();
            return;
          }
          const timeLeftStr = formatTimeLeft(timeLeftMs);
          const options = { weekday: 'short', month: 'short', day: 'numeric' };
          const examDateStr = nextExam.examStart.toLocaleDateString(undefined, options);
          nextExamStrong.textContent = nextExam.paper;
          nextExamDateSpan.textContent = examDateStr;
          nextExamTimeLeftSpan.textContent = `${label}: ${timeLeftStr}`;

          const msToStart = nextExam.examStart - now;
          const hoursToStart = msToStart / (1000 * 60 * 60);

          nextExamDiv.classList.remove("hour1", "hour2", "hour3", "hour4plus", "alert", "default");

          if (label === "Starts in" && msToStart <= 30 * 60 * 1000 && msToStart > 0) {
            nextExamDiv.classList.add("alert");
          } else if (label === "Starts in" && msToStart > 0) {
            if (hoursToStart <= 1) {
              nextExamDiv.classList.add("hour1");
            } else if (hoursToStart <= 2) {
              nextExamDiv.classList.add("hour2");
            } else if (hoursToStart <= 3) {
              nextExamDiv.classList.add("hour3");
            } else {
              nextExamDiv.classList.add("hour4plus");
            }
          } else {
            nextExamDiv.classList.add("default");
          }
        }

        nextExamDiv.classList.add("cursor-pointer");
        nextExamDiv.setAttribute("role", "link");
        nextExamDiv.setAttribute("tabindex", "0");
        nextExamDiv.setAttribute("aria-label", `Next exam is ${nextExam.paper} on ${nextExam.examStart.toLocaleDateString(undefined, { weekday: 'short', month: 'short', day: 'numeric' })}, click to open details`);
        nextExamDiv.onclick = () => {
          window.open(nextExam.path, "_blank", "noopener,noreferrer");
        };
        nextExamDiv.onkeypress = (e) => {
          if (e.key === "Enter" || e.key === " ") {
            e.preventDefault();
            nextExamDiv.click();
          }
        };

        updateTimeLeft();
        if (nextExamInterval) clearInterval(nextExamInterval);
        nextExamInterval = setInterval(updateTimeLeft, 1000);
      }

      function scheduleNextUpdate() {
        const now = new Date();
        const next5pm = new Date(now);
        next5pm.setHours(17, 0, 0, 0);
        if (now >= next5pm) {
          next5pm.setDate(next5pm.getDate() + 1);
        }
        const msUntilNext5pm = next5pm - now;
        setTimeout(() => {
          updateNextExamNotification();
          render();
          scheduleNextUpdate();
        }, msUntilNext5pm);
      }

      function render() {
        renderDateFilters();
        renderExams();
        updateNextExamNotification();
      }

      updateCurrentDate();
      setInterval(updateCurrentDate, 1000);
      render();
      scheduleNextUpdate();
    })();
  </script>
</body>
</html>
